<!DOCTYPE html>
<html lang="en">
<head>
    <!-- head content -->
</head>
<body>
    <!-- Content -->
    <div class="container mt-4">
        <h2>Add Lesson</h2>
        <form method="post">
            <!-- Student Dropdown -->
            <div class="form-group">
                <label for="student">Student</label>
                <select class="form-control" id="student" name="student_id" onchange="updateSchoolTypeAndSubjects()">
                    <option value="">Select a Student</option>
                    {% for student in students %}
                    <option value="{{ student.StudentID }}">{{ student.FirstName }} {{ student.LastName }}</option>
                    {% endfor %}
                </select>
            </div>

            <!-- Schooltype Dropdown (Initially Empty) -->
            <div class="form-group">
                <label for="schooltype">School Type</label>
                <select class="form-control" id="schooltype" name="schooltype_id">
                    <!-- Options will be dynamically populated -->
                </select>
            </div>

            <!-- Subject Dropdown (Initially Empty) -->
            <div class="form-group">
                <label for="subject">Subject</label>
                <select class="form-control" id="subject" name="subject_id">
                    <!-- Options will be dynamically populated -->
                </select>
            </div>

            <!-- Date and Time Fields -->
            <div class="form-group">
                <label for="date">Date</label>
                <input type="date" class="form-control" id="date" name="date" required>
            </div>
            <div class="form-group">
                <label for="start_time">Start Time</label>
                <input type="time" class="form-control" id="start_time" name="start_time" required>
            </div>
            <div class="form-group">
                <label for="end_time">End Time</label>
                <input type="time" class="form-control" id="end_time" name="end_time" required>
            </div>

            <!-- Tutor Dropdown (Initially Empty) -->
            <div class="form-group">
                <label for="tutor">Tutor</label>
                <select class="form-control" id="tutor" name="tutor_id">
                    <!-- Options will be dynamically populated -->
                </select>
            </div>

            <!-- Submit Button -->
            <button type="submit" class="btn btn-primary">Add Lesson</button>
        </form>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const studentSelect = document.getElementById('student');
            const schooltypeSelect = document.getElementById('schooltype');
            const subjectSelect = document.getElementById('subject');
            const tutorSelect = document.getElementById('tutor');
        
            // Handle change in student selection
            studentSelect.addEventListener('change', function() {
                const studentId = this.value;
                if (studentId) {
                    fetchSchoolTypeForStudent(studentId);
                } else {
                    clearDropdowns();
                }
            });
        
            // Function to fetch school type for a selected student
            function fetchSchoolTypeForStudent(studentId) {
                fetch(`/api/schooltype_for_student/${studentId}`)
                .then(response => response.json())
                .then(data => {
                    if (data.schooltype_id) {
                        schooltypeSelect.innerHTML = `<option value="${data.schooltype_id}">${data.schooltype_name}</option>`;
                        fetchSubjects(data.schooltype_id);
                    }
                })
                .catch(error => console.error('Error:', error));
            }
        
            // Function to fetch and populate subjects
            function fetchSubjects(schooltypeId) {
                fetch(`/api/subjects/${schooltypeId}`)
                .then(response => response.json())
                .then(subjects => {
                    populateDropdown(subjectSelect, subjects);
                })
                .catch(error => console.error('Error:', error));
            }
        
            // Listen for changes in the subject to fetch tutors
            subjectSelect.addEventListener('change', function() {
                const subjectId = this.value;
                if (subjectId) {
                    fetchTutorsForSubject(subjectId);
                } else {
                    tutorSelect.innerHTML = '';
                }
            });
        
            // Function to fetch and populate tutors based on selected subject
            function fetchTutorsForSubject(subjectId) {
                fetch(`/api/tutors/${subjectId}`) // Ensure you have this API endpoint
                .then(response => response.json())
                .then(tutors => {
                    populateDropdown(tutorSelect, tutors);
                })
                .catch(error => console.error('Error:', error));
            }
        
            // Helper function to populate dropdown options
            function populateDropdown(dropdown, items) {
                let options = items.map(item => `<option value="${item.id}">${item.name}</option>`).join('');
                dropdown.innerHTML = options;
            }
        
            // Helper function to clear dropdowns
            function clearDropdowns() {
                schooltypeSelect.innerHTML = '';
                subjectSelect.innerHTML = '';
                tutorSelect.innerHTML = '';
            }
        });
        </script>
        
        
</body>
</html>
