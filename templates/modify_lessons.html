<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Modify Lessons</title>
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css">
    <style>
        #lessons-table tr.selected {
            background-color: #add8e6;
        }
    </style>
</head>
<body>
    <!-- Navigation Bar -->
    <nav class="navbar navbar-expand-lg navbar-dark bg-dark">
        <a class="navbar-brand" href="/admin_dashboard">Admin Panel</a>
        <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation">
            <span class="navbar-toggler-icon"></span>
        </button>
        <div class="collapse navbar-collapse" id="navbarNav">
            <ul class="navbar-nav">
                <li class="nav-item active">
                    <a class="nav-link" href="/modify_lessons">Modify Lesson</a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" href="#">Modify Users</a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" href="/modify_subjects">Modify Subjects</a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" href="/modify_family">Modify Family</a>
                </li>
                <!-- Add more links as needed -->
            </ul>
        </div>
    </nav>
    <div class="container mt-4">
        <h2>Modify Lessons</h2>
        <table class="table" id="lessons-table">
            <thead>
                <tr>
                    <th>Date</th>
                    <th>Start Time</th>
                    <th>End Time</th>
                    <th>Tutor</th>
                    <th>Student</th>
                    <th>Subject</th>
                    <th>Actions</th>
                </tr>
            </thead>
            <tbody>
                {% for lesson in lessons %}
                <tr>
                    <td>{{ lesson.date }}</td>
                    <td>{{ lesson.start_time }}</td>
                    <td>{{ lesson.end_time }}</td>
                    <td>{{ lesson.tutor_name }}</td>
                    <td>{{ lesson.student_name }}</td>
                    <td>{{ lesson.subject_name }}</td>
                    <td>
                        <!-- Add buttons or links for editing and deleting lessons -->
                        <a href="/edit_lesson/{{ lesson.lesson_id }}" class="btn btn-primary btn-sm">Edit</a>
                        <a href="/delete_lesson/{{ lesson.lesson_id }}" class="btn btn-danger btn-sm">Delete</a>
                    </td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>

    <script src="https://code.jquery.com/jquery-3.5.1.slim.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.9.2/dist/umd/popper.min.js"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // Event delegation for row clicks
            document.querySelector('#lessons-table tbody').addEventListener('click', function(event) {
                // Check if the clicked element is a row
                let row = event.target;
                while (row !== this && row.tagName !== 'TR') {
                    row = row.parentNode;
                }
                if (row.tagName === 'TR') {
                    const lessonId = row.getAttribute('data-lesson-id');
                    if (lessonId) {
                        selectLesson(lessonId, row);
                    }
                }
            });

            // Edit button logic
            document.getElementById('edit-btn').addEventListener('click', function() {
                if (selectedLessonId) {
                    window.location.href = '/edit_lesson/' + selectedLessonId; // URL to edit lesson route
                }
            });

            // Delete button logic
            document.getElementById('delete-btn').addEventListener('click', function() {
                if (selectedLessonId && confirm('Are you sure you want to delete this lesson?')) {
                    // Perform the deletion request
                    window.location.href = '/delete_lesson/' + selectedLessonId; // URL to delete lesson route
                }
            });

            // Add button logic
            document.getElementById('add-btn').addEventListener('click', function() {
                window.location.href = '/add_lesson'; // URL to add lesson route
            });
        });

        let selectedLessonId = null;

        function selectLesson(lessonId, row) {
            if (selectedLessonId === lessonId) {
                // Deselect if the same row is clicked again
                selectedLessonId = null;
                document.getElementById('delete-btn').disabled = true;
                document.getElementById('edit-btn').disabled = true;
                row.classList.remove('selected');
            } else {
                // Deselect previously selected row, if any
                const previouslySelectedRow = document.querySelector('#lessons-table tr.selected');
                if (previouslySelectedRow) {
                    previouslySelectedRow.classList.remove('selected');
                }
                
                // Select the row and enable buttons
                selectedLessonId = lessonId;
                document.getElementById('delete-btn').disabled = false;
                document.getElementById('edit-btn').disabled = false;
                row.classList.add('selected');
            }
        }

    </script>
</body>
</html>
